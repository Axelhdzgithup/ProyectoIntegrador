<div class="container mx-auto p-4 text-white mb-16">
<div class="flex items-center mb-4">
    <button class="view-back absolute">
        <img class="w-10" src="Public/Assets/icons/backk.svg" alt="">
    </button>
    <h2 class="text-light-slate-blue font-bold text-2xl text-center w-full">Azúcar en Sangre</h2>
</div>

<div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-8 mt-14">
    <div class="flex justify-between mb-4">
        <div>
            <p>Azúcar en Sangre (mg/dL)</p>
            <p>Min: <span id="minAzucar">--</span> Máx: <span id="maxAzucar">--</span></p>
        </div>
        <div>
            <p>Categoría</p>
            <p>Actual: <span id="categoriaAzucar">--</span></p>
        </div>
    </div>

    <div class="mb-4">
        <button id="graficaAzucarBtn" class="mr-4 py-2 px-4 bg-pink-500 rounded-lg">Gráfica</button>
        <button id="historialAzucarBtn" class="py-2 px-4 bg-gray-600 rounded-lg">Historial</button>
    </div>

    <div id="graficaAzucar" class="hidden">
        <canvas id="azucarChart"></canvas>
    </div>

    <div id="historialAzucar" class="hidden">
        <ul id="historialAzucarList" class="list-disc pl-5"></ul>
    </div>

    <button class="view-diario-in w-full py-2 bg-light-slate-blue rounded-lg font-semibold mt-4">+ Añadir</button>
</div>

<div class="bg-white p-4 rounded-lg shadow-md mt-3">
    <!-- ¿Qué es la Glucosa en Sangre? -->
    <div class="mb-4">
        <h4 class="text-md text-black font-bold mb-2">¿Qué es la Glucosa en Sangre?</h4>
        <p class="text-gray-500 text-sm">La glucosa es un tipo de azúcar que se encuentra en la sangre y es la principal fuente de energía para las células del cuerpo. Es importante mantener los niveles de glucosa en un rango saludable para evitar complicaciones de salud.</p>
    </div>

    <!-- ¿Qué Hacer si No Tienes un Glucómetro? -->
    <div class="mb-4">
        <h4 class="text-md text-black font-bold mb-2">Medición de Glucosa en Sangre</h4>
        <p class="text-gray-500 text-sm mb-2">Si no tienes un glucómetro en casa, considera estas opciones:</p>
        <ul class="list-disc pl-5 text-gray-500 text-sm">
            <li>Visitar una clínica o farmacia: Muchos establecimientos de salud ofrecen servicios de medición de glucosa.</li>
            <li>Consultas médicas: Habla con tu médico sobre cómo obtener un glucómetro o realizar mediciones regulares.</li>
            <li>Programas comunitarios: Algunos programas de salud pública ofrecen pruebas de glucosa gratuitas o a bajo costo.</li>
        </ul>
    </div>
</div>



<div class="bg-white p-4 rounded-lg shadow-md mt-3">
    <h3 class="text-lg text-black font-bold mb-4">Niveles de Azúcar en la Sangre</h3>

    <!-- Bajo -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200">
                    Bajo
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-blue-600">
                    < 70 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-blue-200">
            <div style="width:15%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Un nivel de azúcar bajo puede causar síntomas como mareos, confusión y, en casos graves, pérdida de conciencia.</p>
    </div>

    <!-- Normal -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200">
                    Normal
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-green-600">
                    70 - 99 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-green-200">
            <div style="width:25%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Un nivel de azúcar en sangre dentro de este rango es generalmente considerado saludable y equilibrado.</p>
    </div>

    <!-- Prediabetes -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-600 bg-yellow-200">
                    Prediabetes
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-yellow-600">
                    100 - 125 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-yellow-200">
            <div style="width:20%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Un nivel de azúcar en sangre en este rango indica un riesgo elevado de desarrollar diabetes tipo 2 en el futuro.</p>
    </div>

    <!-- Diabetes -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-600 bg-red-200">
                    Diabetes
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-red-600">
                    ≥ 126 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-red-200">
            <div style="width:40%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Este nivel indica diabetes, una condición crónica que requiere manejo médico y cambios en el estilo de vida.</p>
    </div>

    <p class="text-gray-500 text-sm">*Los valores y rangos pueden variar según las directrices de salud y la evaluación médica.</p>
</div>

<div class="bg-blue-100 p-4 rounded-lg shadow-md mt-3">
    <div>
        <h4 class="text-md text-black font-bold mb-2">Importancia del Monitoreo Regular</h4>
        <p class="text-gray-500 text-sm">Monitorear regularmente los niveles de glucosa en sangre es esencial para las personas con diabetes o aquellas en riesgo de desarrollar la enfermedad. Esto ayuda a manejar y ajustar la dieta, el ejercicio y los medicamentos para mantener la glucosa en un rango saludable.</p>
    </div>
</div>

</div>



<nav class="fixed bottom-0 left-0 w-full bg-white shadow-md md:hidden">
    <div class="max-w-md mx-auto flex justify-around py-2">
        <button class="view-home-main flex flex-col items-center text-gray-600 hover:text-violet-blue active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>                  
            <span class="text-sm">Inicio</span>
        </button>

        <button class="view-article flex flex-col items-center text-black hover:text-violet-blue">
            <img src="../Public/Assets/navbar/diario.svg" alt="diario Icon" class="size-6">                     
            <span class="text-sm">Articulos</span>
        </button>

        
        <div class="view-diario flex flex-col items-center text-black hover:text-violet-blue">
            <img src="../Public/Assets/navbar/bmi.svg" alt="IMC Icon" class="size-6">          
            <span class="text-sm">IMC</span>
        </div>
    </div>
</nav>

<script>

        document.querySelector('.view-back').addEventListener('click', function() {
    loadPartialView('diario-main', document.querySelector('.init'), false);
  });
    // Manejadores de eventos para cambiar entre vistas parciales
    document.querySelector('.view-article').addEventListener('click', function(){
        loadPartialView('article-main', document.querySelector('.init'), false);
    });

    document.querySelector('.view-home-main').addEventListener('click',function(){
        loadPartialView('home-main',document.querySelector('.init'), false);
    })

    document.querySelector('.view-diario-in').addEventListener('click', function(){
        loadPartialView('azucar-in', document.querySelector('.init'), false);
    });

    document.getElementById('graficaAzucarBtn').addEventListener('click', function() {
        document.getElementById('graficaAzucar').classList.remove('hidden');
        document.getElementById('historialAzucar').classList.add('hidden');
        mostrarGraficaAzucar();
    });

    document.getElementById('historialAzucarBtn').addEventListener('click', function() {
        document.getElementById('historialAzucar').classList.remove('hidden');
        document.getElementById('graficaAzucar').classList.add('hidden');
        mostrarHistorialAzucar();
    });

    function mostrarGraficaAzucar() {
        auth.onAuthStateChanged((user) => {
            if (user) {
                const userId = user.uid;
                const glucoseRecordsRef = db.collection("users").doc(userId).collection("glucoseRecords");

                glucoseRecordsRef.orderBy("fecha").get().then((querySnapshot) => {
                    const registros = [];
                    querySnapshot.forEach((doc) => {
                        registros.push(doc.data());
                    });
                    actualizarGraficaAzucar(registros);
                    actualizarMinMaxYActual(registros);
                }).catch((error) => {
                    console.error("Error al obtener registros de glucosa: ", error);
                });
            } else {
                console.log("Usuario no autenticado.");
            }
        });
    }

    function actualizarGraficaAzucar(registros) {
        const fechas = registros.map(registro => registro.fecha.toDate().toLocaleDateString());
        const nivelesAzucar = registros.map(registro => registro.glucosa);

        const ctx = document.getElementById('azucarChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: fechas,
                datasets: [{
                    label: 'Nivel de Azúcar (mg/dL)',
                    data: nivelesAzucar,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Fecha'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Nivel de Azúcar (mg/dL)'
                        }
                    }
                }
            }
        });
    }

    function actualizarMinMaxYActual(registros) {
        if (registros.length > 0) {
            const nivelesAzucar = registros.map(registro => registro.glucosa);
            const minAzucar = Math.min(...nivelesAzucar);
            const maxAzucar = Math.max(...nivelesAzucar);
            const actualAzucar = nivelesAzucar[nivelesAzucar.length - 1];

            document.getElementById('minAzucar').textContent = minAzucar;
            document.getElementById('maxAzucar').textContent = maxAzucar;
            document.getElementById('categoriaAzucar').textContent = obtenerCategoriaAzucar(actualAzucar);
        }
    }

    function obtenerCategoriaAzucar(glucosa) {
        if (glucosa < 70) {
            return 'Bajo';
        } else if (glucosa < 100) {
            return 'Normal';
        } else if (glucosa < 126) {
            return 'Prediabetes';
        } else {
            return 'Diabetes';
        }
    }

    function mostrarHistorialAzucar() {
        const historialList = document.getElementById('historialAzucarList');
        historialList.innerHTML = ''; // Limpiar la lista antes de agregar nuevos elementos

        auth.onAuthStateChanged((user) => {
            if (user) {
                const userId = user.uid;
                const glucoseRecordsRef = db.collection("users").doc(userId).collection("glucoseRecords");

                glucoseRecordsRef.orderBy("fecha").get().then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        const registro = doc.data();
                        const listItem = document.createElement('li');
                        listItem.textContent = `Fecha: ${registro.fecha.toDate().toLocaleDateString()}, Nivel: ${registro.glucosa} mg/dL, Categoría: ${registro.categoria}`;
                        historialList.appendChild(listItem);
                    });
                }).catch((error) => {
                    console.error("Error al obtener registros de glucosa: ", error);
                });
            } else {
                console.log("Usuario no autenticado.");
            }
        });
    }


</script>
