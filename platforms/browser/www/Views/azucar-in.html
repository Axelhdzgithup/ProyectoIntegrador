<body class="bg-gray-900">
    <div class="container mx-auto p-4 text-white">
        <div class="flex items-center mb-4">
            <button class="view-back absolute">
                <img class="w-10" src="Public/Assets/icons/backk.svg" alt="">
            </button>
            <h2 class="text-light-slate-blue font-bold text-2xl text-center w-full">Registro de Glucosa</h2>
        </div>
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg mt-14">
            <form id="glucoseForm" class="space-y-4">
                <div>
                    <label for="glucosa" class="block text-sm font-medium">Nivel de Glucosa (mg/dL)</label>
                    <input type="number" id="glucosa" class="w-full mt-1 p-2 bg-gray-700 rounded-lg" required>
                </div>
                <div class="flex space-x-4">
                    <div>
                        <label for="sexo" class="block text-sm font-medium">Sexo</label>
                        <select id="sexo" class="w-full mt-1 p-2 bg-gray-700 rounded-lg">
                            <option value="hombre">Hombre</option>
                            <option value="mujer">Mujer</option>
                        </select>
                    </div>
                    <div>
                        <label for="edad" class="block text-sm font-medium">Edad</label>
                        <input type="number" id="edad" class="w-full mt-1 p-2 bg-gray-700 rounded-lg" required>
                    </div>
                </div>
                <button type="submit" class="w-full py-2 bg-light-slate-blue rounded-lg font-semibold">Guardar</button>
            </form>
    
            <div id="resultado-glucosa" class="mt-6 hidden">
                <h2 class="text-lg font-bold">Tu nivel de glucosa es...</h2>
                <div class="flex items-center justify-between mt-4">
                    <p id="glucosa-valor" class="text-6xl font-bold"></p>
                    <p id="glucosa-categoria" class="text-lg"></p>
                </div>
                <div class="relative mt-4">
                    <div class="glucosa-bar">
                        <div class="glucosa-segment bajo"></div>
                        <div class="glucosa-segment normal"></div>
                        <div class="glucosa-segment prediabetes"></div>
                        <div class="glucosa-segment diabetes"></div>
                    </div>
                    <div id="glucosa-indicator"></div>
                </div>
                <div class="flex justify-between mt-2 text-sm">
                    <span>Bajo</span>
                    <span>Normal</span>
                    <span>Prediabetes</span>
                    <span>Diabetes</span>
                </div>
            </div>
        </div>

        
<div class="bg-white p-4 rounded-lg shadow-md mt-3">
    <h3 class="text-lg text-black font-bold mb-4">Niveles de Azúcar en la Sangre</h3>

    <!-- Bajo -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200">
                    Bajo
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-blue-600">
                    < 70 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-blue-200">
            <div style="width:15%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Un nivel de azúcar bajo puede causar síntomas como mareos, confusión y, en casos graves, pérdida de conciencia.</p>
    </div>

    <!-- Normal -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200">
                    Normal
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-green-600">
                    70 - 99 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-green-200">
            <div style="width:25%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Un nivel de azúcar en sangre dentro de este rango es generalmente considerado saludable y equilibrado.</p>
    </div>

    <!-- Prediabetes -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-600 bg-yellow-200">
                    Prediabetes
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-yellow-600">
                    100 - 125 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-yellow-200">
            <div style="width:20%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Un nivel de azúcar en sangre en este rango indica un riesgo elevado de desarrollar diabetes tipo 2 en el futuro.</p>
    </div>

    <!-- Diabetes -->
    <div class="mb-4">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-600 bg-red-200">
                    Diabetes
                </span>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold inline-block text-red-600">
                    ≥ 126 mg/dL
                </span>
            </div>
        </div>
        <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-red-200">
            <div style="width:40%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
        </div>
        <p class="text-gray-500 text-sm">Este nivel indica diabetes, una condición crónica que requiere manejo médico y cambios en el estilo de vida.</p>
    </div>

    <p class="text-gray-500 text-sm">*Los valores y rangos pueden variar según las directrices de salud y la evaluación médica.</p>
</div>
    </div>
    
    <script>
        document.querySelector('.view-back').addEventListener('click', function() {
            loadPartialView('azucar-main', document.querySelector('.init'), false);
        });
    
        document.getElementById('glucoseForm').addEventListener('submit', function(event) {
            event.preventDefault();
    
            const glucosa = parseFloat(document.getElementById('glucosa').value);
            const sexo = document.getElementById('sexo').value;
            const edad = parseInt(document.getElementById('edad').value);
    
            let categoria = '';
            let glucosaPosition = 0;
    
            if (glucosa < 70) {
                categoria = 'Bajo';
                glucosaPosition = (glucosa / 70) * 25;
            } else if (glucosa < 100) {
                categoria = 'Normal';
                glucosaPosition = 25 + ((glucosa - 70) / (100 - 70)) * 25;
            } else if (glucosa < 126) {
                categoria = 'Prediabetes';
                glucosaPosition = 50 + ((glucosa - 100) / (126 - 100)) * 25;
            } else {
                categoria = 'Diabetes';
                glucosaPosition = 75 + ((glucosa - 126) / (200 - 126)) * 25; // Asumiendo que el máximo es 200
            }
    
            document.getElementById('glucosa-valor').textContent = glucosa;
            document.getElementById('glucosa-categoria').textContent = categoria;
            document.getElementById('glucosa-indicator').style.left = glucosaPosition + '%';
            document.getElementById('resultado-glucosa').classList.remove('hidden');
    
            // Guardar en Firestore
            auth.onAuthStateChanged((user) => {
                if (user) {
                    const userId = user.uid;
    
                    const userRef = db.collection("users").doc(userId);
                    const glucoseRecordsRef = userRef.collection("glucoseRecords");
    
                    glucoseRecordsRef.add({
                        glucosa: glucosa,
                        categoria: categoria,
                        sexo: sexo,
                        edad: edad,
                        fecha: firebase.firestore.FieldValue.serverTimestamp()
                    })
                    .then(() => {
                        console.log("Registro de glucosa guardado correctamente.");
                    })
                    .catch((error) => {
                        console.error("Error al guardar registro de glucosa: ", error);
                    });
                } else {
                    console.log("Usuario no autenticado.");
                    // Aquí puedes manejar el caso donde el usuario no está autenticado
                }
            });
        });
    </script>
    </body>
    