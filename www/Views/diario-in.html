<body class="bg-gray-900">
<div class="container mx-auto p-4 text-white">
    <div class="flex items-center mb-4">
        <button class="view-back absolute">
            <img class="w-10" src="Public/Assets/icons/backk.svg" alt="">
        </button>
        <h2 class="text-light-slate-blue font-bold text-2xl text-center w-full">Nuevo Registro</h2>
    </div>
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg mt-14">
        <form id="imcForm" class="space-y-4">
            <div>
                <label for="peso" class="block text-sm font-medium">Peso (kg)</label>
                <input type="number" id="peso" class="w-full mt-1 p-2 bg-gray-700 rounded-lg" required>
            </div>
            <div>
                <label for="altura" class="block text-sm font-medium">Altura (cm)</label>
                <input type="number" id="altura" class="w-full mt-1 p-2 bg-gray-700 rounded-lg" required>
            </div>
            <div class="flex space-x-4">
                <div>
                    <label for="sexo" class="block text-sm font-medium">Sexo</label>
                    <select id="sexo" class="w-full mt-1 p-2 bg-gray-700 rounded-lg">
                        <option value="hombre">Hombre</option>
                        <option value="mujer">Mujer</option>
                    </select>
                </div>
                <div>
                    <label for="edad" class="block text-sm font-medium">Edad</label>
                    <input type="number" id="edad" class="w-full mt-1 p-2 bg-gray-700 rounded-lg" required>
                </div>
            </div>
            <button type="submit" class="w-full py-2 bg-light-slate-blue rounded-lg font-semibold">Guardar</button>
        </form>

        <div id="resultado" class="mt-6 hidden">
            <h2 class="text-lg font-bold">Tu IMC es...</h2>
            <div class="flex items-center justify-between mt-4">
                <p id="imc" class="text-6xl font-bold"></p>
                <p id="categoria" class="text-lg"></p>
            </div>
            <div class="relative mt-4">
                <div class="imc-bar">
                    <div class="imc-segment peso-bajo"></div>
                    <div class="imc-segment normal"></div>
                    <div class="imc-segment sobrepeso"></div>
                    <div class="imc-segment obesidad"></div>
                </div>
                <div id="imc-indicator"></div>
            </div>
            <div class="flex justify-between mt-2 text-sm">
                <span>Peso bajo</span>
                <span>Normal</span>
                <span>Sobrepeso</span>
                <span>Obesidad</span>
            </div>
        </div>
    </div>

    <div class="bg-white p-4 rounded-lg shadow-md mt-3 mb-16">
        <h3 class="text-lg text-black font-bold mb-4">Niveles de Índice de Masa Corporal (IMC)</h3>
    
        <!-- Bajo peso -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200">
                        Bajo peso
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-blue-600">
                        < 18.5
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-blue-200">
                <div style="width:15%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"></div>
            </div>
            <p class="text-gray-500 text-sm">Un IMC bajo puede indicar desnutrición y está asociado con un mayor riesgo de deficiencias nutricionales.</p>
        </div>
    
        <!-- Peso normal -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200">
                        Peso normal
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-green-600">
                        18.5 - 24.9
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-green-200">
                <div style="width:35%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"></div>
            </div>
            <p class="text-gray-500 text-sm">Un IMC en este rango generalmente indica un peso saludable y un menor riesgo de enfermedades relacionadas con el peso.</p>
        </div>
    
        <!-- Sobrepeso -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-600 bg-yellow-200">
                        Sobrepeso
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-yellow-600">
                        25 - 29.9
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-yellow-200">
                <div style="width:30%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500"></div>
            </div>
            <p class="text-gray-500 text-sm">Un IMC en este rango indica sobrepeso, lo que puede aumentar el riesgo de enfermedades cardíacas y otras condiciones de salud.</p>
        </div>
    
        <!-- Obesidad -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-600 bg-red-200">
                        Obesidad
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-red-600">
                        ≥ 30
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-red-200">
                <div style="width:20%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
            </div>
            <p class="text-gray-500 text-sm">Un IMC de 30 o más indica obesidad, una condición que aumenta significativamente el riesgo de problemas de salud graves.</p>
        </div>
    
        <p class="text-gray-500 text-sm">*Los valores del IMC son aproximados y deben ser interpretados en el contexto de otros indicadores de salud.</p>
    </div>
    
</div>

<nav class="fixed bottom-0 left-0 w-full bg-white shadow-md md:hidden">
    <div class="max-w-md mx-auto flex justify-around py-2">
        <button class="view-home-main flex flex-col items-center text-gray-600 hover:text-violet-blue active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>                  
            <span class="text-sm">Inicio</span>
        </button>

        <button class="view-article flex flex-col items-center text-black hover:text-violet-blue">
            <img src="../Public/Assets/navbar/diario.svg" alt="diario Icon" class="size-6">                     
            <span class="text-sm">Articulos</span>
        </button>

        
        <div class="view-diario flex flex-col items-center text-black hover:text-violet-blue">
            <img src="../Public/Assets/navbar/bmi.svg" alt="IMC Icon" class="size-6">          
            <span class="text-sm">IMC</span>
        </div>
    </div>
</nav>

<!-- JavaScript: Aquí está el código para manejar el formulario y guardar en Firestore -->
<script>

        document.querySelector('.view-back').addEventListener('click', function() {
        loadPartialView('imc-view', document.querySelector('.init'), false);
        });

        // Manejadores de eventos para cambiar entre vistas parciales
        document.querySelector('.view-article').addEventListener('click',function(){
        loadPartialView('article-main',document.querySelector('.init'), false);
    })

    document.querySelector('.view-home-main').addEventListener('click',function(){
        loadPartialView('home-main',document.querySelector('.init'), false);
    })

        document.querySelector('.view-diario').addEventListener('click',function(){
        loadPartialView('diario-in',document.querySelector('.init'), false);
    })

    document.getElementById('imcForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        const peso = parseFloat(document.getElementById('peso').value);
        const altura = parseFloat(document.getElementById('altura').value) / 100; // Convertimos a metros
        const sexo = document.getElementById('sexo').value;
        const edad = parseInt(document.getElementById('edad').value);

        const imc = (peso / (altura * altura)).toFixed(1);

        let categoria = '';
        let imcPosition = 0;

        if (imc < 18.5) {
            categoria = 'Peso bajo';
            imcPosition = (imc / 18.5) * 25;
        } else if (imc < 27.1) {
            categoria = 'Normal';
            imcPosition = 25 + ((imc - 18.5) / (27.1 - 18.5)) * 25;
        } else if (imc < 30.6) {
            categoria = 'Sobrepeso';
            imcPosition = 50 + ((imc - 27.1) / (30.6 - 27.1)) * 25;
        } else {
            categoria = 'Obesidad de clase I';
            imcPosition = 75 + ((imc - 30.6) / (35 - 30.6)) * 25; // Asumiendo que el máximo es 35
        }

        document.getElementById('imc').textContent = imc;
        document.getElementById('categoria').textContent = categoria;
        document.getElementById('imc-indicator').style.left = imcPosition + '%';
        document.getElementById('resultado').classList.remove('hidden');

        // Guardar en Firestore
        auth.onAuthStateChanged((user) => {
            if (user) {
                const userId = user.uid; // Obtener el ID único del usuario autenticado

                const userRef = db.collection("users").doc(userId);
                const imcRecordsRef = userRef.collection("imcRecords");

                imcRecordsRef.add({
                    peso: peso,
                    altura: altura * 100, // Convertir a cm
                    imc: parseFloat(imc),
                    categoria: categoria,
                    sexo: sexo,
                    edad: edad,
                    fecha: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    console.log("Registro IMC guardado correctamente.");
                })
                .catch((error) => {
                    console.error("Error al guardar registro IMC: ", error);
                });
            } else {
                console.log("Usuario no autenticado.");
                // Aquí puedes manejar el caso donde el usuario no está autenticado
            }
        });
    });
</script>
</body>