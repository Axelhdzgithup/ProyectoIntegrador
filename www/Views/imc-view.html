<div class="container mx-auto p-4 text-white mb-16">

    <div class="flex items-center mb-4">
        <button class="view-back absolute">
            <img class="w-10" src="Public/Assets/icons/backk.svg" alt="">
        </button>
        <h2 class="text-light-slate-blue font-bold text-2xl text-center w-full">Peso y IMC</h2>
    </div>

    <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-8 mt-14">
        <div class="flex justify-between mb-4">
            <div>
                <p>Peso (kg)</p>
                <p>Min: <span id="minPeso">--</span> Máx: <span id="maxPeso">--</span></p>
            </div>
            <div>
                <p>BMI</p>
                <p>Min: <span id="minBMI">--</span> Máx: <span id="maxBMI">--</span></p>
            </div>
        </div>

        <div class="mb-4">
            <button id="graficaBtn" class="mr-4 py-2 px-4 bg-pink-500 rounded-lg">Gráfica</button>
            <button id="historialBtn" class="py-2 px-4 bg-gray-600 rounded-lg">Historial</button>
        </div>

        <div id="grafica" class="hidden">
            <canvas id="pesoChart"></canvas>
        </div>

        <div id="historial" class="hidden">
            <ul id="historialList" class="list-disc pl-5"></ul>
        </div>

        <button class="view-diario-in w-full py-2 bg-light-slate-blue rounded-lg font-semibold mt-4">+ Añadir</button>
    </div>

    <div id="resultado" class="mt-6 hidden">
        <h2 class="text-lg font-bold">Tu IMC es...</h2>
        <div class="flex items-center justify-between mt-4">
            <p id="imc" class="text-6xl font-bold"></p>
            <p id="categoria" class="text-lg"></p>
        </div>
        <div class="relative mt-4">
            <div class="imc-bar">
                <div class="imc-segment peso-bajo"></div>
                <div class="imc-segment normal"></div>
                <div class="imc-segment sobrepeso"></div>
                <div class="imc-segment obesidad"></div>
            </div>
            <div id="imc-indicator"></div>
        </div>
        <div class="flex justify-between mt-2 text-sm">
            <span>Peso bajo</span>
            <span>Normal</span>
            <span>Sobrepeso</span>
            <span>Obesidad</span>
        </div>
    </div>

    <div class="bg-white p-4 rounded-lg shadow-md mt-3">
        <h3 class="text-lg text-black font-bold mb-4">Composición del Cuerpo Humano</h3>
    
        <!-- Agua Corporal -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200 m-1">
                        Agua Corporal
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-blue-600">
                        60%
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-blue-200">
                <div style="width:60%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"></div>
            </div>
            <p class="text-gray-500 text-sm">El agua es esencial para todas las funciones corporales, incluyendo la regulación de la temperatura y la eliminación de desechos.</p>
        </div>
    
        <!-- Músculo Esquelético -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200">
                        Músculo Esquelético
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-green-600">
                        40%
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-green-200">
                <div style="width:40%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"></div>
            </div>
            <p class="text-gray-500 text-sm">Los músculos esqueléticos son cruciales para el movimiento, la postura y la producción de calor.</p>
        </div>
    
        <!-- Grasa Corporal -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-600 bg-yellow-200">
                        Grasa Corporal
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-yellow-600">
                        20%
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-yellow-200">
                <div style="width:20%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500"></div>
            </div>
            <p class="text-gray-500 text-sm">La grasa corporal actúa como reserva de energía y aislante térmico, además de proteger órganos internos.</p>
        </div>
    
        <!-- Minerales -->
        <div class="mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-gray-600 bg-gray-200">
                        Minerales
                    </span>
                </div>
                <div class="text-right">
                    <span class="text-xs font-semibold inline-block text-gray-600">
                        5%
                    </span>
                </div>
            </div>
            <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-gray-200">
                <div style="width:5%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-gray-500"></div>
            </div>
            <p class="text-gray-500 text-sm">Los minerales son esenciales para la formación de huesos, la transmisión nerviosa y otras funciones corporales.</p>
        </div>
    
        <p class="text-gray-500 text-sm">*Los porcentajes son aproximados y pueden variar según la persona.</p>
    </div>
    
    
    
    

    <div class="bg-green-600 p-4 rounded-lg shadow-md mt-6">
        <h3 class="text-lg font-bold mb-4">Consejos de Salud</h3>
        <ul class="list-disc pl-5">
            <li>Beber al menos 8 vasos de agua al día.</li>
            <li>Realizar ejercicio al menos 30 minutos diarios.</li>
            <li>Evitar comidas procesadas y altas en azúcares.</li>
        </ul>
    </div>

    <div class="bg-blue-100 p-4 rounded-lg shadow-md mt-6">
        <h3 class="text-lg text-black font-bold mb-4">Historias de Éxito</h3>
        <p class="text-sm text-gray-700">"Desde que empecé a seguir estos consejos, he perdido 10 kg y me siento mucho más saludable y enérgico." - Juan P.</p>
    </div>


</div>

<nav class="fixed bottom-0 left-0 w-full bg-white shadow-md md:hidden">
    <div class="max-w-md mx-auto flex justify-around py-2">
        <button class="view-home-main flex flex-col items-center text-gray-600 hover:text-violet-blue active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>                  
            <span class="text-sm">Inicio</span>
        </button>

        <button class="view-article flex flex-col items-center text-black hover:text-violet-blue">
            <img src="../Public/Assets/navbar/diario.svg" alt="diario Icon" class="size-6">                     
            <span class="text-sm">Articulos</span>
        </button>

        
        <div class="view-diario flex flex-col items-center text-black hover:text-violet-blue">
            <img src="../Public/Assets/navbar/bmi.svg" alt="IMC Icon" class="size-6">          
            <span class="text-sm">IMC</span>
        </div>
    </div>
</nav>

<script>

    document.querySelector('.view-back').addEventListener('click', function() {
    loadPartialView('diario-main', document.querySelector('.init'), false);
  });
    // Manejadores de eventos para cambiar entre vistas parciales
    document.querySelector('.view-article').addEventListener('click', function(){
        loadPartialView('article-main', document.querySelector('.init'), false);
    });

    document.querySelector('.view-home-main').addEventListener('click',function(){
        loadPartialView('home-main',document.querySelector('.init'), false);
    })

    document.querySelector('.view-diario-in').addEventListener('click', function(){
        loadPartialView('diario-in', document.querySelector('.init'), false);
    });

    document.getElementById('historialBtn').addEventListener('click', function() {
        document.getElementById('historial').classList.remove('hidden');
        document.getElementById('grafica').classList.add('hidden');
        mostrarHistorial();
    });

    document.getElementById('graficaBtn').addEventListener('click', function() {
        document.getElementById('grafica').classList.remove('hidden');
        document.getElementById('historial').classList.add('hidden');
        mostrarGrafica();
    });

    // Función para mostrar el historial de registros
    function mostrarHistorial() {
        const historialList = document.getElementById('historialList');
        historialList.innerHTML = ''; // Limpiar la lista antes de agregar nuevos elementos

        auth.onAuthStateChanged((user) => {
            if (user) {
                const userId = user.uid; // ID único del usuario autenticado

                // Referencia a los registros IMC del usuario
                const imcRecordsRef = db.collection("users").doc(userId).collection("imcRecords");

                // Consulta para obtener los registros ordenados por fecha
                imcRecordsRef.orderBy("fecha").get().then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        const registro = doc.data();
                        const listItem = document.createElement('li');
                        listItem.textContent = `Fecha: ${registro.fecha.toDate().toLocaleDateString()}, Peso: ${registro.peso}, IMC: ${registro.imc}`;
                        historialList.appendChild(listItem);
                    });
                }).catch((error) => {
                    console.error("Error al obtener registros IMC: ", error);
                });
            } else {
                console.log("Usuario no autenticado.");
                // Manejar el caso donde el usuario no está autenticado
            }
        });
    }

    // Función para mostrar la gráfica con los registros obtenidos
    function mostrarGrafica() {
        auth.onAuthStateChanged((user) => {
            if (user) {
                const userId = user.uid; // ID único del usuario autenticado

                // Referencia a los registros IMC del usuario
                const imcRecordsRef = db.collection("users").doc(userId).collection("imcRecords");

                // Consulta para obtener los registros ordenados por fecha
                imcRecordsRef.orderBy("fecha").get().then((querySnapshot) => {
                    const registros = [];
                    querySnapshot.forEach((doc) => {
                        registros.push(doc.data());
                    });
                    actualizarGrafica(registros);
                }).catch((error) => {
                    console.error("Error al obtener registros IMC: ", error);
                });
            } else {
                console.log("Usuario no autenticado.");
                // Manejar el caso donde el usuario no está autenticado
            }
        });
    }

    // Función para actualizar la gráfica con los registros obtenidos
    function actualizarGrafica(registros) {
        // Preparar datos para la gráfica
        const fechas = registros.map(registro => registro.fecha.toDate().toLocaleDateString());
        const pesos = registros.map(registro => registro.peso);
        const bmis = registros.map(registro => registro.imc);

        // Actualizar valores mínimos y máximos de peso y BMI
        const minPeso = Math.min(...pesos);
        const maxPeso = Math.max(...pesos);
        const minBMI = Math.min(...bmis);
        const maxBMI = Math.max(...bmis);

        // Actualizar los valores en el DOM
        document.getElementById('minPeso').textContent = minPeso.toFixed(1);
        document.getElementById('maxPeso').textContent = maxPeso.toFixed(1);
        document.getElementById('minBMI').textContent = minBMI.toFixed(1);
        document.getElementById('maxBMI').textContent = maxBMI.toFixed(1);

        // Configurar datos y opciones de la gráfica usando Chart.js
        const ctx = document.getElementById('pesoChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: fechas,
                datasets: [
                    {
                        label: 'Peso (kg)',
                        data: pesos,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: 'IMC',
                        data: bmis,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Mostrar elementos de la gráfica y ocultar historial inicialmente
        document.getElementById('grafica').classList.remove('hidden');
        document.getElementById('historial').classList.add('hidden');
    }
</script>
